<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlurD AI - Intelligent Document Processing System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-top {
            background: rgba(0,0,0,0.1);
            padding: 8px 0;
            font-size: 0.85em;
        }
        
        .header-top-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .header-info {
            display: flex;
            gap: 20px;
            color: rgba(255,255,255,0.8);
        }
        
        .header-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .header-social {
            display: flex;
            gap: 10px;
        }
        
        .header-social a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .header-social a:hover {
            color: white;
        }
        
        .header-main {
            padding: 20px 0;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .brand-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .brand-text h1 {
            font-size: 2.2em;
            margin: 0;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #e8f4fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .brand-text p {
            margin: 5px 0 0 0;
            font-size: 1em;
            opacity: 0.9;
            color: #ecf0f1;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .header-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .header-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-1px);
        }
        
        /* Main Navigation Bar */
        .main-nav {
            background: #ffffff;
            border-bottom: 2px solid #e9ecef;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 0;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 18px 24px;
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            font-size: 0.95em;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            height: 60px;
            box-sizing: border-box;
        }
        
        .nav-link:hover {
            color: #2c3e50;
            background: #f8f9fa;
            border-bottom-color: #dee2e6;
        }
        
        .nav-link.active {
            color: #2c3e50;
            background: #ffffff;
            border-bottom-color: #3498db;
            font-weight: 600;
        }
        
        .nav-badge {
            background: #dc3545;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7em;
            font-weight: 600;
            min-width: 16px;
            text-align: center;
            margin-left: 4px;
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-action-btn {
            background: transparent;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }
        
        .nav-action-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
            color: #212529;
        }
        
        .nav-action-btn.primary {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }
        
        .nav-action-btn.primary:hover {
            background: #2980b9;
            border-color: #2980b9;
        }
        
        .page-wrapper {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 0;
        }
        
        .old-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            display: none;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* Enhanced Upload Section */
        .upload-section {
            margin-bottom: 40px;
        }
        
        .upload-card {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .upload-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .upload-header h2 {
            margin: 0 0 10px 0;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .upload-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .upload-area {
            padding: 30px;
        }
        
        .drop-zone {
            border: 3px dashed #e0e7ff;
            border-radius: 16px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .drop-zone::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102,126,234,0.05) 0%, transparent 70%);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }
        
        .drop-zone:hover::before,
        .drop-zone.dragover::before {
            opacity: 1;
            transform: rotate(45deg) scale(1.1);
        }
        
        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0ff 100%);
            transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(102,126,234,0.2);
        }
        
        .drop-zone-content {
            position: relative;
            z-index: 2;
        }
        
        .drop-zone i {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
            display: block;
            transition: all 0.3s ease;
        }
        
        .drop-zone:hover i {
            transform: scale(1.1);
            color: #5a67d8;
        }
        
        .drop-zone h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .drop-zone p {
            color: #718096;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        
        .upload-hints {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .hint-item {
            color: #4a5568;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .hint-item i {
            color: #48bb78;
            font-size: 0.8em;
        }
        
        /* Advanced Options */
        .advanced-options {
            background: #f7fafc;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .options-header h4 {
            margin: 0 0 20px 0;
            color: #2d3748;
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .option-group {
            display: flex;
            flex-direction: column;
        }
        
        .option-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.95em;
        }
        
        .option-select {
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            color: #2d3748;
            font-size: 0.95em;
            transition: all 0.2s ease;
        }
        
        .option-select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 0;
        }
        
        .checkbox-item input[type="checkbox"] {
            display: none;
        }
        
        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 4px;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .checkbox-item input:checked + .checkmark {
            background: #667eea;
            border-color: #667eea;
        }
        
        .checkbox-item input:checked + .checkmark::after {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 12px;
            top: -1px;
            left: 2px;
        }
        
        .options-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        /* Progress Section */
        .progress-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            display: none;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .progress-header h4 {
            margin: 0;
            color: #2d3748;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-percentage {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1em;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
            position: relative;
        }
        
        .step i {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #a0aec0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .step.active i {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed i {
            background: #48bb78;
            color: white;
        }
        
        .step span {
            font-size: 0.85em;
            color: #718096;
            font-weight: 500;
        }
        
        .step.active span {
            color: #667eea;
            font-weight: 600;
        }
        
        /* Enhanced Results Section */
        .results-section {
            display: none;
            margin-top: 40px;
        }
        
        .document-preview {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .preview-header {
            background: linear-gradient(135deg, #4fd1c7 0%, #06b6d4 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview-header h3 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-controls {
            display: flex;
            gap: 8px;
        }
        
        .processing-results {
            display: grid;
            gap: 30px;
        }
        
        .result-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .result-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-header h3 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-actions {
            display: flex;
            gap: 8px;
        }
        
        .result-content {
            padding: 30px;
        }
        
        .text-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .stat-item i {
            color: #667eea;
        }
        
        .comparison-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .comparison-item h4 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Enhanced Button Styles */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85em;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-outline:hover {
            background: #667eea;
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4fd1c7 0%, #06b6d4 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        /* Badge Styles */
        .classification-badge, .rag-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* Filter Select */
        .filter-select {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            font-size: 0.9em;
        }

        .main-content {
            padding: 0;
        }

        .upload-section {
            margin-bottom: 40px;
        }        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .drop-zone i {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
            display: block;
        }
        
        .drop-zone h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .drop-zone p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        .status-message {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .results-section {
            display: none;
            margin-top: 40px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .results-header h2 {
            color: #333;
        }
        
        .copy-btn {
            background: #28a745;
            font-size: 0.9em;
            padding: 8px 20px;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .text-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            min-height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            resize: vertical;
            color: #333;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Document Classification Styles */
        .document-classifications {
            margin-top: 30px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f1f8e9 100%);
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            display: none;
        }
        
        .classification-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .classification-header h3 {
            margin: 0 10px;
            color: #1976d2;
            font-size: 1.2em;
        }
        
        .classification-badge {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: auto;
        }
        
        .classification-item {
            background: white;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .classification-item:hover {
            border-color: #2196f3;
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.1);
        }
        
        .classification-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .document-type {
            font-weight: bold;
            font-size: 1.1em;
            color: #1976d2;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .classification-confidence {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .confidence-score {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .confidence-high { background: #4caf50; color: white; }
        .confidence-medium { background: #ff9800; color: white; }
        .confidence-low { background: #f44336; color: white; }
        
        .high-confidence-header {
            animation: fadeIn 0.5s ease-in;
        }
        
        .high-confidence-header h4 {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .confidence-info {
            font-style: italic;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .classification-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e3f2fd;
        }
        
        .keywords-found, .patterns-found {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }
        
        .keyword-tag, .pattern-tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        /* RAG Suggestions Styles */
        .rag-suggestions {
            margin-top: 30px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            display: none;
        }
        
        .rag-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rag-header h3 {
            color: #495057;
            margin-left: 10px;
        }
        
        .rag-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .suggestion-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .suggestion-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .suggestion-item.selected {
            border-color: #007bff;
            background: #f8f9fa;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .suggestion-checkbox {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .suggestion-content {
            margin-left: 35px;
        }
        
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .field-name {
            font-weight: bold;
            color: #495057;
            font-size: 1.1em;
        }
        
        .field-category {
            background: #17a2b8;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .field-type {
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .category-name { background: #28a745; }
        .category-address { background: #fd7e14; }
        .category-phone_number { background: #6610f2; }
        .category-aadhar_number { background: #dc3545; }
        .category-id_number { background: #6f42c1; }
        .category-other { background: #6c757d; }
        
        .confidence-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .confidence-high {
            background: #d4edda;
            color: #155724;
        }
        
        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .suggested-value {
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 8px 0;
            border-left: 4px solid #007bff;
        }
        
        .suggestion-reasoning {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
        }
        
        .rag-actions {
            margin-top: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .action-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .action-row:last-child {
            margin-bottom: 0;
        }
        
        .rag-actions select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
            min-width: 150px;
        }
        
        .rag-actions .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background: #6c757d !important;
        }
        
        .btn-info {
            background: #17a2b8 !important;
        }
        
        .btn-success {
            background: #28a745 !important;
        }
        
        .rag-actions .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .rag-actions .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .selected-count {
            color: #007bff;
            font-weight: bold;
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .suggestion-item.preview-mode {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .suggestion-item.filtered-out {
            display: none;
        }
        
        .confidence-very-high { background: #28a745; }
        .confidence-high { background: #ffc107; color: #212529; }
        .confidence-medium { background: #fd7e14; }
        .confidence-low { background: #dc3545; }
        
        /* Image blur overlay system */
        .image-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        .uploaded-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .field-overlay {
            position: absolute;
            background: rgba(0, 123, 255, 0.3);
            border: 2px solid #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .field-overlay.selected {
            background: rgba(255, 193, 7, 0.4);
            border-color: #ffc107;
        }
        
        .field-overlay.blurred {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            background: rgba(220, 53, 69, 0.4);
            border-color: #dc3545;
            border-width: 3px;
        }
        
        .field-overlay:hover {
            background: rgba(0, 123, 255, 0.5);
            transform: scale(1.02);
        }
        
        .field-label {
            position: absolute;
            top: -25px;
            left: 0;
            background: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 10;
        }
        
        .field-overlay.selected .field-label {
            background: #ffc107;
            color: #212529;
        }
        
        .field-overlay.blurred .field-label {
            background: #dc3545;
        }
        
        /* Generated Form Styles */
        .generated-form {
            background: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,123,255,0.15);
        }
        
        .generated-form h4 {
            color: #007bff;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1em;
            transition: all 0.2s;
        }
        
        .form-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
            outline: none;
        }
        
        .form-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .selected-fields {
            margin-top: 15px;
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 8px;
            padding: 15px;
            display: none;
        }
        
        .selected-fields h4 {
            color: #155724;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .selected-fields-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .selected-field-item {
            background: white;
            border: 1px solid #c3e6c3;
            border-radius: 6px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-field-info {
            flex-grow: 1;
        }
        
        .selected-field-name {
            font-weight: bold;
            color: #155724;
        }
        
        .selected-field-value {
            font-family: 'Courier New', monospace;
            color: #495057;
            font-size: 0.9em;
        }
        
        .copy-field-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
        }
        
        .copy-field-btn:hover {
            background: #218838;
        }
        
        .comparison-item h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .comparison-item .text-output {
            min-height: 100px;
            font-size: 13px;
        }
        
        .supported-formats {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #e2e8f0;
            text-align: left;
        }
        
        .supported-formats h3 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: center;
            justify-content: center;
        }
        
        .format-categories {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .format-category h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .format-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .format-tag {
            background: white;
            color: #4a5568;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            font-size: 0.85em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .format-tag.image {
            border-color: #667eea;
            color: #667eea;
        }
        
        .format-tag.document {
            border-color: #ed64a6;
            color: #ed64a6;
        }
        
        .format-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .format-tag.image:hover {
            background: #667eea;
            color: white;
        }
        
        .format-tag.document:hover {
            background: #ed64a6;
            color: white;
        }
        
        .format-info {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 1px solid #cbd5e0;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4a5568;
            font-size: 0.9em;
        }
        
        .info-item i {
            color: #48bb78;
        }
        
        .structured-data {
            background: #f8f9ff;
            border: 1px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .structured-data h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .structured-items {
            display: grid;
            gap: 10px;
        }
        
        .structured-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .structured-item strong {
            color: #333;
        }
        
        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
        }
        
        /* Legacy Navigation Section - Hidden */
        .nav-section {
            display: none;
        }
        
        .nav-tabs {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            background: #ffffff;
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
        }
        
        .nav-tab button {
            width: 100%;
            padding: 15px 20px;
            border: none;
            background: #f8f9fa;
            color: #495057;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .nav-tab button:hover {
            background: #e9ecef;
            color: #212529;
        }
        
        .nav-tab button.active {
            background: #ffffff;
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            padding: 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .document-history-nav {
            background: #ffffff;
            border-bottom: 1px solid #dee2e6;
            padding: 15px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .history-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .history-filter {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .history-filter select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            background: #ffffff;
            color: #495057;
            font-size: 0.9em;
        }
        
        .history-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-item .stat-value {
            font-weight: 600;
            color: #495057;
        }
        
        .badge {
            background: #dc3545;
            color: white;
            border-radius: 12px;
            padding: 2px 6px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 5px;
            min-width: 18px;
            text-align: center;
            display: inline-block;
        }
        
        /* Footer Styles */
        .app-footer {
            background: #2c3e50;
            color: white;
            margin-top: auto;
        }
        
        .footer-main {
            padding: 40px 0 20px;
            background: #34495e;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 40px;
        }
        
        .footer-section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #ecf0f1;
            font-weight: 600;
        }
        
        .footer-about {
            color: #bdc3c7;
            line-height: 1.6;
        }
        
        .footer-about p {
            margin-bottom: 15px;
        }
        
        .footer-features {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .feature-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 8px;
        }
        
        .footer-links a {
            color: #bdc3c7;
            text-decoration: none;
            font-size: 0.95em;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-links a:hover {
            color: #3498db;
        }
        
        .footer-stats {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            text-align: center;
        }
        
        .stat-item-footer {
            color: #ecf0f1;
        }
        
        .stat-number {
            font-size: 1.4em;
            font-weight: 700;
            color: #3498db;
            display: block;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #bdc3c7;
            margin-top: 4px;
        }
        
        .footer-bottom {
            background: #2c3e50;
            padding: 20px 0;
            border-top: 1px solid #34495e;
        }
        
        .footer-bottom-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #bdc3c7;
            font-size: 0.9em;
        }
        
        .footer-social {
            display: flex;
            gap: 15px;
        }
        
        .social-link {
            color: #bdc3c7;
            font-size: 1.2em;
            transition: color 0.3s ease;
        }
        
        .social-link:hover {
            color: #3498db;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-top-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .footer-bottom-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css">
</head>
<body>
    <!-- App Header -->
    <header class="app-header">
        <div class="header-top">
            <div class="header-top-content">
                <div class="header-info">
                    <span><i class="fas fa-clock"></i> Online 24/7</span>
                    <span><i class="fas fa-shield-alt"></i> Secure Processing</span>
                    <span><i class="fas fa-language"></i> Multi-language Support</span>
                </div>
                <div class="header-social">
                    <a href="#" title="GitHub"><i class="fab fa-github"></i></a>
                    <a href="#" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
        
        <div class="header-main">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-logo">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="brand-text">
                        <h1>BurD AI</h1>
                        <p>Intelligent Document Processing System</p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>System Online</span>
                    </div>
                    <a href="#" class="header-btn">
                        <i class="fas fa-question-circle"></i>
                        Help & Support
                    </a>
                    <a href="#" class="header-btn">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-container">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchTab('upload')" id="nav-upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Upload Documents</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('history')" id="nav-history">
                        <i class="fas fa-history"></i>
                        <span>Document History</span>
                        <span class="nav-badge" id="nav-history-count">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('analytics')" id="nav-analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showOCRInfo()">
                        <i class="fas fa-info-circle"></i>
                        <span>OCR Info</span>
                    </a>
                </li>
            </ul>
            
            <div class="nav-actions">
                <a href="#" class="nav-action-btn" onclick="exportHistory()">
                    <i class="fas fa-download"></i>
                    <span>Export Data</span>
                </a>
                <a href="#" class="nav-action-btn primary">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="container">
        
        <!-- Tab Content -->
        <div class="tab-content active" id="uploadTab">
            <div class="main-content">
            <div class="upload-section">
                <!-- Upload Card -->
                <div class="upload-card">
                    <div class="upload-header">
                        <h2><i class="fas fa-upload"></i> Document Upload</h2>
                        <p>Upload any document for intelligent OCR processing and data extraction</p>
                    </div>
                    
                    <div class="upload-area">
                        <div class="drop-zone" id="dropZone">
                            <div class="drop-zone-content">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h3>Drag & Drop Your Document</h3>
                                <p>or click to browse files</p>
                                <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-folder-open"></i> Choose File
                                </button>
                                
                                <div class="upload-hints">
                                    <span class="hint-item"><i class="fas fa-check"></i> Max size: 10MB</span>
                                    <span class="hint-item"><i class="fas fa-check"></i> Multiple formats supported</span>
                                    <span class="hint-item"><i class="fas fa-check"></i> AI-powered processing</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Options Panel -->
                        <div class="advanced-options">
                            <div class="options-header">
                                <h4><i class="fas fa-cogs"></i> Processing Options</h4>
                            </div>
                            
                            <div class="options-grid">
                                <div class="option-group">
                                    <label class="option-label">
                                        <i class="fas fa-brain"></i> OCR Engine
                                    </label>
                                    <select id="ocrEngine" class="option-select">
                                        <option value="auto">Auto (Smart Selection)</option>
                                        <option value="deep_learning">Deep Learning (Neural Networks)</option>
                                        <option value="traditional">Traditional (Tesseract)</option>
                                        <option value="benchmark">Benchmark (Compare All)</option>
                                    </select>
                                </div>
                                
                                <div class="option-group">
                                    <label class="option-label">
                                        <i class="fas fa-language"></i> Language
                                    </label>
                                    <select id="ocrLanguage" class="option-select">
                                        <option value="auto">Auto Detect</option>
                                        <option value="eng">English</option>
                                        <option value="spa">Spanish</option>
                                        <option value="fra">French</option>
                                        <option value="deu">German</option>
                                        <option value="chi_sim">Chinese (Simplified)</option>
                                        <option value="jpn">Japanese</option>
                                    </select>
                                </div>
                                
                                <div class="option-group">
                                    <label class="option-label">
                                        <i class="fas fa-filter"></i> Preprocessing
                                    </label>
                                    <select id="preprocessing" class="option-select">
                                        <option value="auto">Auto Enhancement</option>
                                        <option value="denoise">Noise Reduction</option>
                                        <option value="contrast">Contrast Enhancement</option>
                                        <option value="none">None</option>
                                    </select>
                                </div>
                                
                                <div class="option-group">
                                    <label class="option-label">
                                        <i class="fas fa-robot"></i> AI Features
                                    </label>
                                    <div class="checkbox-group">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="enableClassification" checked>
                                            <span class="checkmark"></span>
                                            Document Classification
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="enableFieldSuggestion" checked>
                                            <span class="checkmark"></span>
                                            Field Suggestions
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="options-actions">
                                <button type="button" class="btn btn-outline" onclick="resetOptions()">
                                    <i class="fas fa-undo"></i> Reset to Default
                                </button>
                                <button type="button" class="btn btn-info" onclick="showOCRInfo()">
                                    <i class="fas fa-info-circle"></i> Learn More
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept="image/*,application/pdf">
                
                <!-- Progress Section -->
                <div class="progress-section" id="progressSection">
                    <div class="progress-header">
                        <h4><i class="fas fa-spinner fa-spin"></i> Processing Document...</h4>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-steps">
                        <div class="step" id="step-upload">
                            <i class="fas fa-upload"></i>
                            <span>Upload</span>
                        </div>
                        <div class="step" id="step-preprocess">
                            <i class="fas fa-image"></i>
                            <span>Preprocess</span>
                        </div>
                        <div class="step" id="step-ocr">
                            <i class="fas fa-eye"></i>
                            <span>OCR</span>
                        </div>
                        <div class="step" id="step-analyze">
                            <i class="fas fa-brain"></i>
                            <span>Analyze</span>
                        </div>
                        <div class="step" id="step-complete">
                            <i class="fas fa-check"></i>
                            <span>Complete</span>
                        </div>
                    </div>
                </div>
                
                <div class="status-message" id="statusMessage"></div>
            </div>
            
            <div class="results-section" id="resultsSection">
                <!-- Document Preview -->
                <div class="document-preview" id="documentPreview">
                    <div class="preview-header">
                        <h3><i class="fas fa-image"></i> Document Preview</h3>
                        <div class="preview-controls">
                            <button class="btn btn-sm" onclick="zoomIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="btn btn-sm" onclick="zoomOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="btn btn-sm" onclick="resetZoom()">
                                <i class="fas fa-compress-arrows-alt"></i>
                            </button>
                            <button class="btn btn-sm" onclick="toggleFullscreen()">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="image-container" id="imageContainer">
                        <img id="uploadedImage" class="uploaded-image" src="" alt="Uploaded Document">
                        <div id="fieldOverlays"></div>
                        <div class="image-overlay" id="imageOverlay">
                            <div class="overlay-info">
                                <span id="imageInfo"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Processing Results -->
                <div class="processing-results">
                    <!-- OCR Results -->
                    <div class="result-card">
                        <div class="result-header">
                            <h3><i class="fas fa-file-text"></i> Extracted Text</h3>
                            <div class="result-actions">
                                <button class="btn btn-sm" onclick="formatText()">
                                    <i class="fas fa-align-left"></i> Format
                                </button>
                                <button class="btn btn-sm" onclick="copyToClipboard()">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="btn btn-sm" onclick="downloadText()">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                        
                        <div class="result-content">
                            <div class="text-output" id="extractedText" placeholder="Extracted text will appear here..."></div>
                            
                            <div class="text-stats">
                                <div class="stat-item">
                                    <i class="fas fa-spell-check"></i>
                                    <span>Words: <strong id="wordCount">0</strong></span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-font"></i>
                                    <span>Characters: <strong id="charCount">0</strong></span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-percentage"></i>
                                    <span>Confidence: <strong id="ocrConfidence">0%</strong></span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Processing: <strong id="processingTime">0s</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Document Classification -->
                    <div class="result-card" id="documentClassifications" style="display: none;">
                        <div class="result-header">
                            <h3><i class="fas fa-tags"></i> Document Classification</h3>
                            <div class="classification-badge">AI-Powered</div>
                        </div>
                        <div class="result-content">
                            <div id="classificationsList"></div>
                        </div>
                    </div>
                    
                    <!-- AI Field Suggestions -->
                    <div class="result-card" id="ragSuggestions">
                        <div class="result-header">
                            <h3><i class="fas fa-robot"></i> AI Field Suggestions</h3>
                            <div class="rag-badge">RAG-Powered</div>
                        </div>
                        <div class="result-content">
                            <div id="suggestionsList"></div>
                            
                            <div class="rag-actions" id="ragActions" style="display: none;">
                                <div class="action-row">
                                    <button class="btn btn-sm" id="selectAllBtn" onclick="selectAllSuggestions()">
                                        <i class="fas fa-check-square"></i> Select All
                                    </button>
                                    <button class="btn btn-sm" id="clearAllBtn" onclick="clearAllSuggestions()">
                                        <i class="fas fa-times"></i> Clear All
                                    </button>
                                    <button class="btn btn-sm" id="selectHighConfidenceBtn" onclick="selectHighConfidenceSuggestions()">
                                        <i class="fas fa-star"></i> High Confidence
                                    </button>
                                    <select id="categoryFilter" onchange="filterByCategory(this.value)" class="filter-select">
                                        <option value="">All Categories</option>
                                    </select>
                                </div>
                                <div class="action-row">
                                    <button class="btn btn-primary" id="copySelectedBtn" onclick="copySelectedFields()" disabled>
                                        <i class="fas fa-copy"></i> Copy Selected (<span id="selectedCount">0</span>)
                                    </button>
                                    <button class="btn btn-success" id="exportJsonBtn" onclick="exportSelectedAsJSON()" disabled>
                                        <i class="fas fa-download"></i> Export JSON
                                    </button>
                                    <button class="btn btn-info" id="generateFormBtn" onclick="generateFormFromSelected()" disabled>
                                        <i class="fas fa-edit"></i> Generate Form
                                    </button>
                                </div>
                            </div>
                            
                            <div class="selected-fields" id="selectedFields">
                                <h4><i class="fas fa-check-circle"></i> Selected Fields (<span id="selectedFieldsCount">0</span>)</h4>
                                <div class="selected-fields-list" id="selectedFieldsList"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Results -->
                    <div class="result-card" id="comparison" style="display: none;">
                        <div class="result-header">
                            <h3><i class="fas fa-balance-scale"></i> OCR Comparison</h3>
                        </div>
                        <div class="comparison-content">
                            <div class="comparison-item">
                                <h4><i class="fas fa-wand-magic-sparkles"></i> Enhanced OCR</h4>
                                <div class="text-output" id="processedText"></div>
                            </div>
                            <div class="comparison-item">
                                <h4><i class="fas fa-eye"></i> Raw OCR</h4>
                                <div class="text-output" id="rawText"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="supported-formats">
                <h3><i class="fas fa-file-image"></i> Supported File Formats</h3>
                <div class="format-categories">
                    <div class="format-category">
                        <h4><i class="fas fa-image"></i> Images</h4>
                        <div class="format-tags">
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                PNG
                            </span>
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                JPG/JPEG
                            </span>
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                GIF
                            </span>
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                BMP
                            </span>
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                TIFF
                            </span>
                            <span class="format-tag image">
                                <i class="fas fa-file-image"></i>
                                WEBP
                            </span>
                        </div>
                    </div>
                    
                    <div class="format-category">
                        <h4><i class="fas fa-file-pdf"></i> Documents</h4>
                        <div class="format-tags">
                            <span class="format-tag document">
                                <i class="fas fa-file-pdf"></i>
                                PDF
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="format-info">
                    <div class="info-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Maximum file size: <strong>10MB</strong></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Multi-language support</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-check-circle"></i>
                        <span>AI-powered enhancement</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
        
        <!-- Document History Tab -->
        <div class="tab-content" id="historyTab">
            <!-- Document History Navigation -->
            <div class="document-history-nav">
                <div class="history-controls">
                    <div class="history-filter">
                        <i class="fas fa-filter"></i>
                        <label>Filter by Type:</label>
                        <select id="historyDocTypeFilter" onchange="loadDocumentHistory()">
                            <option value="">All Documents</option>
                            <option value="invoice">Invoice</option>
                            <option value="receipt">Receipt</option>
                            <option value="form">Form</option>
                            <option value="business_card">Business Card</option>
                            <option value="medical">Medical</option>
                            <option value="legal">Legal</option>
                            <option value="academic">Academic</option>
                            <option value="financial">Financial</option>
                            <option value="government">Government</option>
                            <option value="certificate">Certificate</option>
                            <option value="mrz">MRZ/Passport</option>
                            <option value="general">General</option>
                        </select>
                    </div>
                    <button class="btn" onclick="loadDocumentHistory()" style="padding: 8px 16px; font-size: 0.9em;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn" onclick="exportHistory()" style="padding: 8px 16px; font-size: 0.9em; background: #28a745;">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
                
                <div class="history-stats">
                    <div class="stat-item">
                        <i class="fas fa-file-alt"></i>
                        <span>Total: <span class="stat-value" id="totalDocs">0</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span>Today: <span class="stat-value" id="todayDocs">0</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Success Rate: <span class="stat-value" id="successRate">0%</span></span>
                    </div>
                </div>
            </div>
            
            <!-- Document History Content -->
            <div style="padding: 20px 40px;">
                <div id="historyLoading" style="text-align: center; padding: 40px; display: none;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2em; color: #667eea; margin-bottom: 15px;"></i>
                    <p style="color: #6c757d;">Loading document history...</p>
                </div>
                
                <div id="historyList"></div>
                
                <div id="historyEmpty" style="text-align: center; padding: 60px 20px; color: #6c757d;">
                    <i class="fas fa-inbox" style="font-size: 3em; margin-bottom: 20px; color: #dee2e6;"></i>
                    <h4 style="margin-bottom: 10px; color: #495057;">No Documents Found</h4>
                    <p>Upload and process a document to see history</p>
                    <button class="btn" onclick="switchTab('upload')" style="margin-top: 15px;">
                        <i class="fas fa-upload"></i> Upload First Document
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div class="tab-content" id="analyticsTab">
            <div style="padding: 40px;">
                <h2 style="color: #495057; margin-bottom: 30px;">
                    <i class="fas fa-chart-bar"></i> Document Processing Analytics
                </h2>
                
                <div id="historyStatistics"></div>
                
                <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
                    <i class="fas fa-chart-line" style="font-size: 3em; margin-bottom: 20px; color: #dee2e6;"></i>
                    <h4 style="margin-bottom: 10px; color: #495057;">Analytics Coming Soon</h4>
                    <p>Detailed analytics and insights will be available here</p>
                </div>
            </div>
    </div>

    <script>
        // Tab Switching Functions
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all nav links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected tab content and activate nav link
            const selectedTab = document.getElementById(tabName + 'Tab');
            const selectedNavLink = document.getElementById('nav-' + tabName);
            
            if (selectedTab) selectedTab.classList.add('active');
            if (selectedNavLink) selectedNavLink.classList.add('active');
            
            // Load data if switching to history tab
            if (tabName === 'history') {
                setTimeout(() => {
                    loadDocumentHistory();
                    updateHistoryStats();
                }, 100);
            }
        }
        
        // Update history count badge
        function updateHistoryCount(count) {
            const badge = document.getElementById('nav-history-count');
            if (badge) {
                badge.textContent = count || 0;
                badge.style.display = count > 0 ? 'inline-block' : 'none';
            }
        }
        
        // Update history statistics in nav
        function updateHistoryStats() {
            fetch('/api/document-history')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.records) {
                        const total = data.records.length;
                        const today = new Date().toDateString();
                        const todayCount = data.records.filter(record => 
                            new Date(record.created_at).toDateString() === today
                        ).length;
                        const successCount = data.records.filter(record => 
                            record.confidence > 0.7
                        ).length;
                        const successRate = total > 0 ? Math.round((successCount / total) * 100) : 0;
                        
                        // Update navigation stats
                        const totalEl = document.getElementById('totalDocs');
                        const todayEl = document.getElementById('todayDocs');
                        const successEl = document.getElementById('successRate');
                        
                        if (totalEl) totalEl.textContent = total;
                        if (todayEl) todayEl.textContent = todayCount;
                        if (successEl) successEl.textContent = successRate + '%';
                        
                        // Update badge
                        updateHistoryCount(total);
                    }
                })
                .catch(error => console.error('Error updating history stats:', error));
        }
        
        // Export history function
        function exportHistory() {
            showStatus('Preparing export...', 'info');
            
            fetch('/api/document-history')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.records) {
                        const csvContent = convertToCSV(data.records);
                        downloadCSV(csvContent, 'document_history_export.csv');
                        showStatus('History exported successfully!', 'success');
                    } else {
                        showStatus('No data to export', 'info');
                    }
                })
                .catch(error => {
                    console.error('Export error:', error);
                    showStatus('Export failed: ' + error.message, 'error');
                });
        }
        
        function convertToCSV(records) {
            const headers = ['Date', 'Filename', 'Document Type', 'Confidence', 'Method', 'Text Length'];
            const csvRows = [headers.join(',')];
            
            records.forEach(record => {
                const row = [
                    new Date(record.created_at).toLocaleString(),
                    record.filename || '',
                    record.document_type || '',
                    (record.confidence * 100).toFixed(1) + '%',
                    record.processing_metadata?.method_used || '',
                    record.extracted_text ? record.extracted_text.length : 0
                ];
                csvRows.push(row.map(field => `"${String(field).replace(/"/g, '""')}"`).join(','));
            });
            
            return csvRows.join('\n');
        }
        
        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
        
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const statusMessage = document.getElementById('statusMessage');
        const resultsSection = document.getElementById('resultsSection');
        const extractedText = document.getElementById('extractedText');
        const processedText = document.getElementById('processedText');
        const rawText = document.getElementById('rawText');
        const comparison = document.getElementById('comparison');

        // Drag and drop functionality
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
        }

        function showProgress() {
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
        }

        function updateProgress(percent) {
            progressFill.style.width = percent + '%';
        }

        function hideProgress() {
            progressBar.style.display = 'none';
        }

        function handleFile(file) {
            // Validate file type
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/bmp', 'image/tiff', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                showStatus('Please select a valid image file (PNG, JPG, GIF, BMP, TIFF, WEBP)', 'error');
                return;
            }

            // Validate file size (16MB)
            if (file.size > 16 * 1024 * 1024) {
                showStatus('File too large. Maximum size is 16MB.', 'error');
                return;
            }

            // Display the uploaded image
            displayUploadedImage(file);
            
            // Get selected OCR engine
            const ocrEngine = document.getElementById('ocrEngine').value;
            
            if (ocrEngine === 'benchmark') {
                benchmarkOCREngines(file);
            } else {
                uploadAndProcess(file, ocrEngine);
            }
        }
        
        function displayUploadedImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageContainer = document.getElementById('imageContainer');
                const uploadedImage = document.getElementById('uploadedImage');
                
                uploadedImage.src = e.target.result;
                imageContainer.style.display = 'block';
                
                // Clear any existing overlays
                const fieldOverlays = document.getElementById('fieldOverlays');
                fieldOverlays.innerHTML = '';
            };
            reader.readAsDataURL(file);
        }

        function uploadAndProcess(file, ocrEngine = 'auto') {
            const formData = new FormData();
            formData.append('file', file);

            hideStatus();
            showProgress();
            updateProgress(20);
            
            // Determine upload endpoint and method based on OCR engine
            let uploadUrl = '/upload';
            let statusMessage = 'Processing with OCR...';
            
            if (ocrEngine === 'deep_learning') {
                uploadUrl = '/api/deep-learning-ocr/process';
                formData.append('engine', 'auto');
                formData.append('confidence_threshold', '0.6');
                statusMessage = 'Processing with Deep Learning OCR...';
            } else if (ocrEngine === 'traditional') {
                statusMessage = 'Processing with Traditional OCR...';
            } else {
                statusMessage = 'Processing with Smart OCR Selection...';
            }
            
            showStatus('Uploading image...', 'info');

            fetch(uploadUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                updateProgress(60);
                showStatus(statusMessage, 'info');
                return response.json();
            })
            .then(data => {
                updateProgress(100);
                hideProgress();
                
                if (data.success) {
                    if (ocrEngine === 'deep_learning') {
                        displayDeepLearningResults(data);
                    } else {
                        showStatus(`<i class="fas fa-check-circle"></i> Text extracted successfully from ${data.filename}!`, 'success');
                        displayResults(data, null);
                    }
                } else {
                    showStatus(`  Error: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                hideProgress();
                showStatus(`  Upload failed: ${error.message}`, 'error');
                console.error('Error:', error);
            });
        }

        // displayResults function is defined below with enhanced functionality

        function getDocumentTypeInfo(docType) {
            const typeMap = {
                'invoice': { emoji: '', message: 'Invoice detected! Extracting billing information' },
                'receipt': { emoji: '', message: 'Receipt detected! Extracting transaction data' },
                'form': { emoji: '', message: 'Form detected! Extracting field data' },
                'business_card': { emoji: '', message: 'Business Card detected! Extracting contact information' },
                'medical': { emoji: '', message: 'Medical Document detected! Extracting patient data' },
                'legal': { emoji: '', message: 'Legal Document detected! Extracting contract information' },
                'academic': { emoji: '', message: 'Academic Document detected! Extracting transcript data' },
                'financial': { emoji: '', message: 'Financial Document detected! Extracting account information' },
                'government': { emoji: '', message: 'Government Document detected! Extracting official data' },
                'mrz': { emoji: '', message: 'MRZ Document (Passport/ID) detected! Using specialized OCR' },
                'certificate': { emoji: '', message: 'Certificate detected! Using Raw OCR (best accuracy)' },
                'general': { emoji: '', message: 'Document processed successfully! Text extracted' }
            };
            
            return typeMap[docType] || { emoji: '', message: 'Document processed successfully!' };
        }

        function displayUniversalStructuredData(docType, structuredData) {
            // Create structured data display
            const resultsSection = document.getElementById('resultsSection');
            if (!resultsSection) return;
            
            let structuredDiv = document.getElementById('structuredData');
            if (!structuredDiv) {
                structuredDiv = document.createElement('div');
                structuredDiv.id = 'structuredData';
                structuredDiv.className = 'structured-data';
                resultsSection.appendChild(structuredDiv);
            }
            
            const typeInfo = getDocumentTypeInfo(docType);
            let html = `<h3>${typeInfo.emoji} ${getDocumentTitle(docType)}</h3><div class="structured-items">`;
            
            // Get field labels for the document type
            const fieldLabels = getFieldLabels(docType);
            
            for (const [key, value] of Object.entries(structuredData)) {
                if (value !== null && value !== undefined && value !== '' && 
                    key !== 'note' && typeof value !== 'object') {
                    const label = fieldLabels[key] || formatFieldName(key);
                    html += `<div class="structured-item"><strong>${label}:</strong> ${value}</div>`;
                }
            }
            
            // Handle special cases for arrays and objects
            if (structuredData.items && Array.isArray(structuredData.items)) {
                html += '<div class="structured-item"><strong> Items:</strong>';
                structuredData.items.forEach(item => {
                    html += `<div style="margin-left: 20px;">â€¢ ${item.name || item}: ${item.price || ''}</div>`;
                });
                html += '</div>';
            }
            
            if (structuredData.parties && Array.isArray(structuredData.parties)) {
                html += '<div class="structured-item"><strong> Parties:</strong>';
                structuredData.parties.forEach(party => {
                    html += `<div style="margin-left: 20px;">â€¢ ${party}</div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            structuredDiv.innerHTML = html;
        }
        
        function getDocumentTitle(docType) {
            const titles = {
                'invoice': 'Invoice Information',
                'receipt': 'Receipt Details', 
                'form': 'Form Data',
                'business_card': 'Contact Information',
                'medical': 'Medical Information',
                'legal': 'Legal Document Data',
                'academic': 'Academic Information',
                'financial': 'Financial Data',
                'government': 'Government Document Info',
                'mrz': 'MRZ Document Information',
                'certificate': 'Certificate Information',
                'general': 'Document Information'
            };
            return titles[docType] || 'Document Information';
        }
        
        function getFieldLabels(docType) {
            const labelMaps = {
                'invoice': {
                    'invoice_number': 'Invoice Number',
                    'total_amount': 'Total Amount',
                    'date': 'Date',
                    'vendor': 'Vendor'
                },
                'receipt': {
                    'store': 'Store',
                    'total': 'Total',
                    'date': 'Date',
                    'time': 'Time'
                },
                'form': {
                    'name': 'Full Name',
                    'first_name': 'First Name',
                    'last_name': 'Last Name',
                    'address': 'Address',
                    'phone': 'Phone',
                    'email': 'Email'
                },
                'business_card': {
                    'company': 'Company',
                    'email': 'Email',
                    'phone': 'Phone',
                    'website': 'Website',
                    'title': 'Title'
                },
                'medical': {
                    'patient_name': 'Patient Name',
                    'date_of_birth': 'Date of Birth',
                    'doctor': 'Doctor'
                },
                'legal': {
                    'document_type': 'Document Type',
                    'date': 'Date'
                },
                'academic': {
                    'student_name': 'Student Name',
                    'gpa': 'GPA',
                    'degree': 'Degree',
                    'institution': 'Institution'
                },
                'financial': {
                    'account_number': 'Account Number',
                    'balance': 'Balance',
                    'bank': 'Bank'
                },
                'government': {
                    'license_number': 'License Number',
                    'expiration_date': 'Expiration Date',
                    'issuing_authority': 'Issuing Authority'
                },
                'general': {
                    'line_count': 'Lines',
                    'word_count': 'Words',
                    'char_count': 'Characters'
                }
            };
            return labelMaps[docType] || {};
        }
        
        function formatFieldName(key) {
            // Convert snake_case to Title Case
            return key.replace(/_/g, ' ')
                     .split(' ')
                     .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                     .join(' ');
        }

        function displayMRZData(mrzData) {
            // Legacy function - now uses universal display
            displayUniversalStructuredData('mrz', mrzData);
        }

        function displayStructuredData(structuredData) {
            // Legacy function for certificates - now uses universal display
            displayUniversalStructuredData('certificate', structuredData);
        }

        function displayDocumentClassifications(classifications) {
            const classificationSection = document.getElementById('documentClassifications');
            const classificationsList = document.getElementById('classificationsList');
            
            if (!classifications || classifications.length === 0) {
                classificationSection.style.display = 'none';
                return;
            }
            
            // Clear previous classifications
            classificationsList.innerHTML = '';
            
            // Add header with high confidence filtering info
            const headerHTML = `
                <div class="high-confidence-header" style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #007bff;">
                    <h4 style="color: #007bff; margin: 0 0 8px 0;"><i class="fas fa-bullseye"></i> High Confidence Document Types (â‰¥70%)</h4>
                    <p style="color: #666; margin: 0; font-size: 0.9em;">Only showing document types with high confidence scores to ensure accuracy.</p>
                </div>
            `;
            classificationsList.innerHTML = headerHTML;
            
            // Display each classification
            classifications.forEach((classification, index) => {
                const confidence = parseFloat(classification.confidence);
                let confidenceClass = 'confidence-low';
                if (confidence > 0.7) confidenceClass = 'confidence-high';
                else if (confidence > 0.4) confidenceClass = 'confidence-medium';
                
                // Get document type icons
                const documentIcons = {
                    'AADHAR_CARD': 'fas fa-id-card',
                    'VOTER_ID': 'fas fa-vote-yea',
                    'PAN_CARD': 'fas fa-credit-card',
                    'DRIVING_LICENSE': 'fas fa-car',
                    'PASSPORT': 'fas fa-passport',
                    'MARKSHEET': 'fas fa-clipboard',
                    'RATION_CARD': 'fas fa-utensils',
                    'BANK_PASSBOOK': 'fas fa-university',
                    'BIRTH_CERTIFICATE': 'fas fa-baby',
                    'COMMUNITY_CERTIFICATE': 'fas fa-scroll',
                    'SMART_CARD': 'fas fa-credit-card',
                    'invoice': 'fas fa-file-invoice',
                    'receipt': 'fas fa-receipt',
                    'form': 'fas fa-wpforms',
                    'business_card': 'fas fa-briefcase',
                    'medical': 'fas fa-hospital',
                    'legal': 'fas fa-balance-scale',
                    'academic': 'fas fa-graduation-cap',
                    'financial': 'fas fa-dollar-sign',
                    'government': 'fas fa-landmark',
                    'certificate': 'fas fa-certificate',
                    'mrz': 'fas fa-passport',
                    'general': 'fas fa-file'
                };
                
                const iconClass = documentIcons[classification.document_type] || 'fas fa-file';
                const displayType = classification.document_type.replace(/_/g, ' ');
                
                const keywordTags = classification.keywords_found.map(keyword => 
                    `<span class="keyword-tag">${keyword}</span>`
                ).join(' ');
                
                const classificationHTML = `
                    <div class="classification-item">
                        <div class="classification-content">
                            <div class="document-type"><i class="${iconClass}"></i> ${displayType}</div>
                            <div class="classification-confidence">
                                <span class="confidence-score ${confidenceClass}">
                                    ${(confidence * 100).toFixed(1)}%
                                </span>
                            </div>
                        </div>
                        <div class="classification-details">
                            <div class="keywords-found">
                                <strong>Keywords Found:</strong> ${keywordTags || 'None'}
                            </div>
                            <div class="patterns-found">
                                <strong>Pattern Matches:</strong> ${classification.patterns_matched}
                            </div>
                            <div class="reasoning" style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                ${classification.reasoning}
                            </div>
                        </div>
                    </div>
                `;
                
                classificationsList.innerHTML += classificationHTML;
            });
            
            classificationSection.style.display = 'block';
        }

        function displayRAGSuggestions(ragData) {
            const ragSection = document.getElementById('ragSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            const ragActions = document.getElementById('ragActions');
            
            if (!ragData || !ragData.suggestions || ragData.suggestions.length === 0) {
                ragSection.style.display = 'none';
                return;
            }
            
            // Clear previous suggestions
            suggestionsList.innerHTML = '';
            
            // Display suggestions summary if no individual suggestions available
            if (!ragData.suggestions || ragData.suggestions.length === 0) {
                suggestionsList.innerHTML = `
                    <div class="suggestion-item">
                        <div class="suggestion-content">
                            <div class="field-name">${ragData.message || 'No suggestions available'}</div>
                        </div>
                    </div>
                `;
                ragSection.style.display = 'block';
                return;
            }
            
            // Display each suggestion with checkbox
            ragData.suggestions.forEach((suggestion, index) => {
                // Determine confidence level for styling
                const confidence = parseFloat(suggestion.confidence);
                let confidenceClass = 'confidence-low';
                if (confidence > 0.7) confidenceClass = 'confidence-high';
                else if (confidence > 0.4) confidenceClass = 'confidence-medium';
                
                const fieldId = `field_${index}`;
                const categoryClass = `category-${suggestion.field_category}`;
                const suggestionHTML = `
                    <div class="suggestion-item" onclick="toggleSuggestion('${fieldId}')">
                        <input type="checkbox" 
                               class="suggestion-checkbox" 
                               id="${fieldId}" 
                               data-field-name="${suggestion.field_name}"
                               data-field-type="${suggestion.field_type}"
                               data-field-category="${suggestion.field_category}"
                               data-field-value="${suggestion.value}"
                               data-confidence="${suggestion.confidence}"
                               onchange="updateSelectionCount()"
                               onclick="event.stopPropagation()">
                        <div class="suggestion-content">
                            <div class="suggestion-header">
                                <div>
                                    <span class="field-name">${suggestion.field_name}</span>
                                    <span class="field-category ${categoryClass}">${suggestion.field_category.replace('_', ' ').toUpperCase()}</span>
                                    <span class="field-type">${suggestion.field_type}</span>
                                </div>
                                <span class="confidence-badge ${confidenceClass}">${(confidence * 100).toFixed(1)}%</span>
                            </div>
                            <div class="suggested-value">${suggestion.value}</div>
                            <div class="suggestion-reasoning">${suggestion.reasoning || 'AI-detected field match'}</div>
                        </div>
                    </div>
                `;
                suggestionsList.innerHTML += suggestionHTML;
            });
            
            ragSection.style.display = 'block';
            ragActions.style.display = 'flex';
            updateSelectionCount();
            
            // Create field overlays on the image
            createFieldOverlays(ragData.suggestions);
        }
        
        function createFieldOverlays(suggestions) {
            const imageContainer = document.getElementById('imageContainer');
            const fieldOverlays = document.getElementById('fieldOverlays');
            
            if (!imageContainer || imageContainer.style.display === 'none') {
                return; // No image displayed
            }
            
            // Clear existing overlays
            fieldOverlays.innerHTML = '';
            
            suggestions.forEach((suggestion, index) => {
                // Generate mock coordinates for demonstration
                // In a real implementation, these would come from OCR bounding boxes
                const mockCoords = generateMockFieldCoordinates(index, suggestions.length);
                
                const overlay = document.createElement('div');
                overlay.className = 'field-overlay';
                overlay.id = `overlay_${index}`;
                overlay.style.left = `${mockCoords.x}%`;
                overlay.style.top = `${mockCoords.y}%`;
                overlay.style.width = `${mockCoords.width}%`;
                overlay.style.height = `${mockCoords.height}%`;
                
                // Add field label
                const label = document.createElement('div');
                label.className = 'field-label';
                label.textContent = suggestion.field_name.replace('_', ' ');
                overlay.appendChild(label);
                
                // Add click handler to toggle selection
                overlay.addEventListener('click', () => {
                    const fieldId = `field_${index}`;
                    const checkbox = document.getElementById(fieldId);
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        toggleSuggestion(fieldId);
                        updateFieldOverlay(overlay, checkbox.checked);
                    }
                });
                
                fieldOverlays.appendChild(overlay);
            });
        }
        
        function generateMockFieldCoordinates(index, total) {
            // Generate realistic field positions for different document types
            const patterns = [
                { x: 10, y: 15, width: 35, height: 8 },  // Header field
                { x: 10, y: 30, width: 25, height: 6 },  // Name field
                { x: 45, y: 30, width: 30, height: 6 },  // ID/Number field
                { x: 10, y: 45, width: 40, height: 6 },  // Address field
                { x: 10, y: 60, width: 20, height: 6 },  // Date field
                { x: 40, y: 60, width: 25, height: 6 },  // Amount field
                { x: 10, y: 75, width: 30, height: 6 },  // Additional field
                { x: 50, y: 75, width: 20, height: 6 },  // Final field
            ];
            
            // Use pattern or generate new position
            if (index < patterns.length) {
                return patterns[index];
            } else {
                return {
                    x: 10 + (index % 3) * 25,
                    y: 20 + Math.floor(index / 3) * 15,
                    width: 20 + Math.random() * 15,
                    height: 5 + Math.random() * 3
                };
            }
        }
        
        function updateFieldOverlay(overlay, isSelected) {
            if (isSelected) {
                overlay.classList.add('selected');
            } else {
                overlay.classList.remove('selected');
            }
        }
        
        function toggleBlurMode() {
            const blurBtn = document.getElementById('toggleBlurBtn');
            const overlays = document.querySelectorAll('.field-overlay');
            
            window.blurMode = !window.blurMode;
            
            if (window.blurMode) {
                blurBtn.innerHTML = '<i class="fas fa-eye"></i> Exit Blur';
                blurBtn.classList.add('btn-danger');
                blurBtn.classList.remove('btn-warning');
                
                // Apply blur to selected overlays
                overlays.forEach(overlay => {
                    const overlayIndex = overlay.id.replace('overlay_', '');
                    const checkbox = document.getElementById(`field_${overlayIndex}`);
                    if (checkbox && checkbox.checked) {
                        overlay.classList.add('blurred');
                    }
                });
                
                showStatus('Blur mode enabled - selected fields will be blurred', 'info');
            } else {
                blurBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Blur Mode';
                blurBtn.classList.add('btn-warning');
                blurBtn.classList.remove('btn-danger');
                
                // Remove blur from all overlays
                overlays.forEach(overlay => {
                    overlay.classList.remove('blurred');
                });
                
                showStatus('Blur mode disabled', 'info');
            }
        }
        
        function toggleSuggestion(fieldId) {
            const checkbox = document.getElementById(fieldId);
            const item = checkbox.closest('.suggestion-item');
            
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
            
            // Update corresponding image overlay
            const overlayIndex = fieldId.replace('field_', '');
            const overlay = document.getElementById(`overlay_${overlayIndex}`);
            if (overlay) {
                updateFieldOverlay(overlay, checkbox.checked);
                
                // Apply blur if in blur mode
                if (window.blurMode && checkbox.checked) {
                    overlay.classList.add('blurred');
                } else {
                    overlay.classList.remove('blurred');
                }
            }

            updateSelectionCount();
            updateSelectedFieldsDisplay();
        }
        
        function updateSelectionCount() {
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            const selectedCount = document.querySelectorAll('.suggestion-checkbox:checked').length;
            
            // Update count display
            document.getElementById('selectedCount').textContent = selectedCount;
            
            // Enable/disable action buttons
            const copyBtn = document.getElementById('copySelectedBtn');
            const exportBtn = document.getElementById('exportJsonBtn');
            const formBtn = document.getElementById('generateFormBtn');
            
            copyBtn.disabled = selectedCount === 0;
            exportBtn.disabled = selectedCount === 0;
            formBtn.disabled = selectedCount === 0;
            
            // Update selected fields display
            updateSelectedFieldsDisplay();
            
            // Update category filter options
            updateCategoryFilter();
        }
        
        function updateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            const categories = new Set();
            
            checkboxes.forEach(checkbox => {
                const category = checkbox.dataset.fieldCategory;
                if (category) categories.add(category);
            });
            
            // Clear existing options (except first one)
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            // Add category options
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.replace('_', ' ').toUpperCase();
                categoryFilter.appendChild(option);
            });
        }
        
        function selectHighConfidenceSuggestions() {
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            checkboxes.forEach(checkbox => {
                const confidence = parseFloat(checkbox.dataset.confidence || 0);
                if (confidence > 0.8) {
                    checkbox.checked = true;
                    checkbox.closest('.suggestion-item').classList.add('selected');
                }
            });
            updateSelectionCount();
            showStatus('<i class="fas fa-star"></i> High confidence fields selected!', 'success');
        }
        
        function filterByCategory(selectedCategory) {
            const suggestionItems = document.querySelectorAll('.suggestion-item');
            
            suggestionItems.forEach(item => {
                const checkbox = item.querySelector('.suggestion-checkbox');
                const category = checkbox.dataset.fieldCategory;
                
                if (!selectedCategory || category === selectedCategory) {
                    item.classList.remove('filtered-out');
                } else {
                    item.classList.add('filtered-out');
                }
            });
            
            if (selectedCategory) {
                showStatus(`Filtered to ${selectedCategory.replace('_', ' ').toUpperCase()} category`, 'info');
            } else {
                showStatus('Showing all categories', 'info');
            }
        }
        
        function selectCurrentCategory() {
            const categoryFilter = document.getElementById('categoryFilter');
            const selectedCategory = categoryFilter.value;
            
            if (!selectedCategory) {
                showStatus('Please select a category first', 'warning');
                return;
            }
            
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            let selectedCount = 0;
            
            checkboxes.forEach(checkbox => {
                const category = checkbox.dataset.fieldCategory;
                const item = checkbox.closest('.suggestion-item');
                
                if (category === selectedCategory && !item.classList.contains('filtered-out')) {
                    checkbox.checked = true;
                    item.classList.add('selected');
                    selectedCount++;
                }
            });
            
            updateSelectionCount();
            showStatus(`Selected ${selectedCount} fields from ${selectedCategory.replace('_', ' ').toUpperCase()}`, 'success');
        }
        
        function togglePreviewMode() {
            const suggestionItems = document.querySelectorAll('.suggestion-item');
            const previewBtn = document.getElementById('togglePreviewBtn');
            const isPreviewMode = previewBtn.textContent.includes('Exit');
            
            if (isPreviewMode) {
                // Exit preview mode
                suggestionItems.forEach(item => {
                    item.classList.remove('preview-mode');
                });
                previewBtn.innerHTML = '<i class="fas fa-eye"></i> Preview Mode';
                showStatus('Preview mode disabled', 'info');
            } else {
                // Enter preview mode
                suggestionItems.forEach(item => {
                    item.classList.add('preview-mode');
                });
                previewBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Exit Preview';
                showStatus('Preview mode enabled - click to exit', 'info');
            }
        }
        
        function generateFormFromSelected() {
            const selectedCheckboxes = document.querySelectorAll('.suggestion-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showStatus('No fields selected for form generation', 'warning');
                return;
            }
            
            // Create form HTML
            let formHTML = '<div class="generated-form"><h4><i class="fas fa-wpforms"></i> Generated Editable Form</h4><form>';
            
            selectedCheckboxes.forEach((checkbox, index) => {
                const fieldName = checkbox.dataset.fieldName;
                const fieldType = checkbox.dataset.fieldType;
                const fieldValue = checkbox.dataset.fieldValue;
                const fieldLabel = fieldName.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                formHTML += `<div class="form-group">
                    <label for="form_field_${index}">${fieldLabel}:</label>`;
                
                // Choose input type based on field type
                if (fieldType === 'email') {
                    formHTML += `<input type="email" id="form_field_${index}" name="${fieldName}" value="${fieldValue}" class="form-input">`;
                } else if (fieldType === 'phone') {
                    formHTML += `<input type="tel" id="form_field_${index}" name="${fieldName}" value="${fieldValue}" class="form-input">`;
                } else if (fieldType === 'date') {
                    formHTML += `<input type="date" id="form_field_${index}" name="${fieldName}" value="${fieldValue}" class="form-input">`;
                } else if (fieldType === 'number' || fieldType === 'currency') {
                    formHTML += `<input type="number" id="form_field_${index}" name="${fieldName}" value="${fieldValue.replace(/[^0-9.-]/g, '')}" class="form-input" step="0.01">`;
                } else {
                    formHTML += `<input type="text" id="form_field_${index}" name="${fieldName}" value="${fieldValue}" class="form-input">`;
                }
                
                formHTML += '</div>';
            });
            
            formHTML += `
                <div class="form-actions">
                    <button type="button" onclick="saveGeneratedForm()" class="btn btn-primary"><i class="fas fa-save"></i> Save Form</button>
                    <button type="button" onclick="copyFormData()" class="btn btn-secondary"><i class="fas fa-clipboard"></i> Copy Data</button>
                    <button type="button" onclick="closeGeneratedForm()" class="btn"><i class="fas fa-times"></i> Close</button>
                </div>
            </form></div>`;
            
            // Add form to page
            const formContainer = document.createElement('div');
            formContainer.id = 'generatedFormContainer';
            formContainer.innerHTML = formHTML;
            
            // Insert after RAG suggestions
            const ragSection = document.getElementById('ragSuggestions');
            if (ragSection && ragSection.parentNode) {
                const nextSibling = ragSection.nextSibling;
                if (nextSibling && nextSibling.parentNode === ragSection.parentNode) {
                    ragSection.parentNode.insertBefore(formContainer, nextSibling);
                } else {
                    ragSection.parentNode.appendChild(formContainer);
                }
            } else {
                const resultsSection = document.getElementById('resultsSection');
                if (resultsSection) {
                    resultsSection.appendChild(formContainer);
                }
            }
            
            // Scroll to form
            formContainer.scrollIntoView({ behavior: 'smooth' });
            
            showStatus(`Generated editable form with ${selectedCheckboxes.length} fields`, 'success');
        }
        
        function updateSelectedFieldsDisplay() {
            const selectedFieldsSection = document.getElementById('selectedFields');
            const selectedFieldsList = document.getElementById('selectedFieldsList');
            const selectedCheckboxes = document.querySelectorAll('.suggestion-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                selectedFieldsSection.style.display = 'none';
                return;
            }
            
            selectedFieldsList.innerHTML = '';
            selectedCheckboxes.forEach((checkbox) => {
                const categoryClass = `category-${checkbox.dataset.fieldCategory}`;
                const fieldHTML = `
                    <div class="selected-field-item">
                        <div class="selected-field-info">
                            <div class="selected-field-name">
                                ${checkbox.dataset.fieldName}
                                <span class="field-category ${categoryClass}">${checkbox.dataset.fieldCategory.replace('_', ' ').toUpperCase()}</span>
                            </div>
                            <div class="selected-field-value">${checkbox.dataset.fieldValue}</div>
                        </div>
                        <button class="copy-field-btn" onclick="copyFieldValue('${checkbox.dataset.fieldValue}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                `;
                selectedFieldsList.innerHTML += fieldHTML;
            });
            
            selectedFieldsSection.style.display = 'block';
        }
        
        function selectAllSuggestions() {
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    checkbox.checked = true;
                    checkbox.closest('.suggestion-item').classList.add('selected');
                }
            });
            updateSelectionCount();
        }
        
        function clearAllSuggestions() {
            const checkboxes = document.querySelectorAll('.suggestion-checkbox');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    checkbox.closest('.suggestion-item').classList.remove('selected');
                }
            });
            updateSelectionCount();
        }
        
        function copySelectedFields() {
            const selectedCheckboxes = document.querySelectorAll('.suggestion-checkbox:checked');
            let copyText = '';
            
            selectedCheckboxes.forEach((checkbox, index) => {
                copyText += `${checkbox.dataset.fieldName}: ${checkbox.dataset.fieldValue}`;
                if (index < selectedCheckboxes.length - 1) {
                    copyText += '\n';
                }
            });
            
            navigator.clipboard.writeText(copyText).then(() => {
                showStatus(`  ${selectedCheckboxes.length} fields copied to clipboard!`, 'success');
                setTimeout(hideStatus, 3000);
            }).catch(err => {
                showStatus('  Failed to copy fields', 'error');
                setTimeout(hideStatus, 3000);
            });
        }
        
        function copyFieldValue(value) {
            navigator.clipboard.writeText(value).then(() => {
                showStatus('  Field value copied to clipboard!', 'success');
                setTimeout(hideStatus, 2000);
            }).catch(err => {
                showStatus('  Failed to copy field value', 'error');
                setTimeout(hideStatus, 3000);
            });
        }
        
        function exportSelectedAsJSON() {
            const selectedCheckboxes = document.querySelectorAll('.suggestion-checkbox:checked');
            const exportData = [];
            
            selectedCheckboxes.forEach(checkbox => {
                exportData.push({
                    field_name: checkbox.dataset.fieldName,
                    field_type: checkbox.dataset.fieldType,
                    field_category: checkbox.dataset.fieldCategory,
                    value: checkbox.dataset.fieldValue,
                    confidence: parseFloat(checkbox.dataset.confidence)
                });
            });
            
            const jsonData = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `rag_fields_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus(`<i class="fas fa-download"></i> Exported ${exportData.length} fields to JSON!`, 'success');
            setTimeout(hideStatus, 3000);
        }
        
        function saveGeneratedForm() {
            const formInputs = document.querySelectorAll('.generated-form .form-input');
            const formData = {};
            
            formInputs.forEach(input => {
                formData[input.name] = input.value;
            });
            
            // Save to localStorage for persistence
            localStorage.setItem('savedFormData', JSON.stringify(formData));
            
            showStatus('Form data saved successfully!', 'success');
            
            // Show saved data in a nice format
            console.log('Saved form data:', formData);
        }
        
        function copyFormData() {
            const formInputs = document.querySelectorAll('.generated-form .form-input');
            let copyText = '';
            
            formInputs.forEach(input => {
                const label = input.previousElementSibling.textContent.replace(':', '');
                copyText += `${label}: ${input.value}\n`;
            });
            
            navigator.clipboard.writeText(copyText).then(() => {
                showStatus('Form data copied to clipboard!', 'success');
            }).catch(err => {
                showStatus('Failed to copy form data', 'error');
            });
        }
        
        function closeGeneratedForm() {
            const formContainer = document.getElementById('generatedFormContainer');
            if (formContainer) {
                formContainer.remove();
                showStatus('Form closed', 'info');
            }
        }

        function copyToClipboard() {
            const text = extractedText.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showStatus('  Text copied to clipboard!', 'success');
                setTimeout(hideStatus, 3000);
            }).catch(err => {
                showStatus('  Failed to copy text', 'error');
                setTimeout(hideStatus, 3000);
            });
        }

        // Auto-hide status messages after 5 seconds
        setInterval(() => {
            const status = document.getElementById('statusMessage');
            if (status.classList.contains('success') && status.style.display === 'block') {
                setTimeout(hideStatus, 3000);
            }
        }, 100);

        function loadDocumentHistory() {
            const historyList = document.getElementById('historyList');
            const historyLoading = document.getElementById('historyLoading');
            const docTypeFilter = document.getElementById('historyDocTypeFilter').value;
            
            // Show loading
            historyLoading.style.display = 'block';
            historyList.innerHTML = '';
            
            // Build query parameters
            const params = new URLSearchParams();
            params.append('limit', '20');
            params.append('days_back', '30');
            if (docTypeFilter) {
                params.append('document_type', docTypeFilter);
            }
            
            fetch(`/api/history?${params}`)
                .then(response => response.json())
                .then(data => {
                    historyLoading.style.display = 'none';
                    
                    if (data.success && data.records.length > 0) {
                        displayHistoryRecords(data.records);
                        updateHistoryFilters(data.records);
                    } else {
                        historyList.innerHTML = `
                            <div style="text-align: center; color: #6c757d; padding: 40px;">
                                <i class="fas fa-inbox" style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;"></i>
                                <p>No documents processed yet</p>
                                <p style="font-size: 0.9em;">Upload and process a document to see history</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    historyLoading.style.display = 'none';
                    historyList.innerHTML = `
                        <div style="text-align: center; color: #dc3545; padding: 20px;">
                            <i class="fas fa-exclamation-triangle"></i> Failed to load history: ${error.message}
                        </div>
                    `;
                    console.error('History loading error:', error);
                });
        }
        
        function displayHistoryRecords(records) {
            const historyList = document.getElementById('historyList');
            
            const recordsHtml = records.map(record => {
                const processedDate = new Date(record.processed_at);
                const timeAgo = getTimeAgo(processedDate);
                const confidence = record.confidence ? (record.confidence * 100).toFixed(0) : 'N/A';
                
                return `
                    <div class="history-record" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer;" onclick="showHistoryRecordDetails('${record._id}')">
                        <div style="display: flex; justify-content: between; align-items: start;">
                            <div style="flex-grow: 1;">
                                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                    <strong style="color: #495057;">${record.filename}</strong>
                                    <span style="background: #007bff; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 10px;">
                                        ${record.document_type.replace('_', ' ').toUpperCase()}
                                    </span>
                                    <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 5px;">
                                        ${confidence}% confidence
                                    </span>
                                </div>
                                <div style="color: #6c757d; font-size: 0.9em; margin-bottom: 8px;">
                                    Processed ${timeAgo} â€¢ ${record.text_length} chars â€¢ ${record.suggestions_count} suggestions
                                </div>
                                <div style="color: #495057; font-size: 0.9em; max-height: 40px; overflow: hidden; line-height: 1.3;">
                                    ${record.extracted_text.substring(0, 150)}${record.extracted_text.length > 150 ? '...' : ''}
                                </div>
                            </div>
                            <div style="margin-left: 15px; color: #007bff;">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            historyList.innerHTML = recordsHtml;
        }
        
        function updateHistoryFilters(records) {
            const docTypeFilter = document.getElementById('historyDocTypeFilter');
            const currentValue = docTypeFilter.value;
            
            // Get unique document types
            const docTypes = [...new Set(records.map(r => r.document_type))];
            
            // Update filter options
            docTypeFilter.innerHTML = '<option value="">All Types</option>';
            docTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.replace('_', ' ').toUpperCase();
                if (type === currentValue) option.selected = true;
                docTypeFilter.appendChild(option);
            });
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} days ago`;
            
            return date.toLocaleDateString();
        }
        
        function showHistoryRecordDetails(recordId) {
            fetch(`/api/history/${recordId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayRecordModal(data.record);
                    } else {
                        showStatus('Failed to load record details', 'error');
                    }
                })
                .catch(error => {
                    showStatus('Error loading record details', 'error');
                    console.error('Record details error:', error);
                });
        }
        
        function displayRecordModal(record) {
            const processedDate = new Date(record.processed_at);
            const confidence = record.confidence ? (record.confidence * 100).toFixed(1) : 'N/A';
            
            const modalHtml = `
                <div id="recordModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;" onclick="closeRecordModal()">
                    <div style="background: white; border-radius: 10px; max-width: 800px; max-height: 80vh; overflow-y: auto; padding: 0;" onclick="event.stopPropagation()">
                        <div style="background: #007bff; color: white; padding: 20px; border-radius: 10px 10px 0 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0;"><i class="fas fa-file-text"></i> ${record.filename}</h3>
                                <button onclick="closeRecordModal()" style="background: none; border: none; color: white; font-size: 1.5em; cursor: pointer;">&times;</button>
                            </div>
                            <p style="margin: 10px 0 0 0; opacity: 0.9;">Processed on ${processedDate.toLocaleString()}</p>
                        </div>
                        <div style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="color: #007bff; font-size: 1.5em; font-weight: bold;">${record.document_type.replace('_', ' ').toUpperCase()}</div>
                                    <div style="color: #6c757d; font-size: 0.9em;">Document Type</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="color: #28a745; font-size: 1.5em; font-weight: bold;">${confidence}%</div>
                                    <div style="color: #6c757d; font-size: 0.9em;">Confidence</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="color: #17a2b8; font-size: 1.5em; font-weight: bold;">${record.suggestions_count || 0}</div>
                                    <div style="color: #6c757d; font-size: 0.9em;">Suggestions</div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #495057; border-bottom: 2px solid #e9ecef; padding-bottom: 10px;">Extracted Text</h4>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em; line-height: 1.5; max-height: 200px; overflow-y: auto; white-space: pre-wrap;">${record.extracted_text}</div>
                            </div>
                            
                            ${record.structured_data && Object.keys(record.structured_data).length > 0 ? `
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: #495057; border-bottom: 2px solid #e9ecef; padding-bottom: 10px;">Structured Data</h4>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                        ${Object.entries(record.structured_data).map(([key, value]) => 
                                            `<div style="margin-bottom: 8px;"><strong>${key.replace('_', ' ')}:</strong> ${value}</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button class="btn" onclick="copyRecordText('${record.extracted_text.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-copy"></i> Copy Text
                                </button>
                                <button class="btn" onclick="downloadRecordData('${record._id}', '${record.filename}')">
                                    <i class="fas fa-download"></i> Download Data
                                </button>
                                <button class="btn" onclick="closeRecordModal()" style="background: #6c757d;">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeRecordModal() {
            const modal = document.getElementById('recordModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function copyRecordText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showStatus('Text copied to clipboard!', 'success');
            }).catch(err => {
                showStatus('Failed to copy text', 'error');
            });
        }
        
        function downloadRecordData(recordId, filename) {
            fetch(`/api/history/${recordId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const jsonData = JSON.stringify(data.record, null, 2);
                        const blob = new Blob([jsonData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${filename.replace(/\.[^/.]+$/, '')}_data.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        showStatus('Document data downloaded!', 'success');
                    }
                })
                .catch(error => {
                    showStatus('Download failed', 'error');
                });
        }
        
        function showHistoryStatistics() {
            const statsSection = document.getElementById('historyStatistics');
            const statsContent = document.getElementById('statsContent');
            
            if (statsSection.style.display === 'block') {
                statsSection.style.display = 'none';
                return;
            }
            
            statsContent.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading statistics...';
            statsSection.style.display = 'block';
            
            fetch('/api/history/statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayStatistics(data.statistics);
                    } else {
                        statsContent.innerHTML = '<div style="color: #dc3545;">Failed to load statistics</div>';
                    }
                })
                .catch(error => {
                    statsContent.innerHTML = '<div style="color: #dc3545;">Error loading statistics</div>';
                    console.error('Statistics error:', error);
                });
        }
        
        function displayStatistics(stats) {
            const statsContent = document.getElementById('statsContent');
            
            const statsHtml = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">${stats.total_documents}</div>
                        <div>Total Documents</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #28a745, #1e7e34); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;">${stats.recent_documents}</div>
                        <div>Recent (7 days)</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #17a2b8, #117a8b); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.2em; font-weight: bold;">${stats.database_type}</div>
                        <div>Database</div>
                    </div>
                </div>
                
                ${stats.document_types.length > 0 ? `
                    <h5 style="color: #495057; margin-bottom: 15px;">Document Types</h5>
                    <div style="display: grid; gap: 10px;">
                        ${stats.document_types.map(type => `
                            <div style="background: white; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${type._id.replace('_', ' ').toUpperCase()}</strong>
                                    <div style="color: #6c757d; font-size: 0.9em;">
                                        Avg. Confidence: ${(type.avg_confidence * 100).toFixed(1)}%
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 1.2em; font-weight: bold; color: #007bff;">${type.count}</div>
                                    <div style="color: #6c757d; font-size: 0.8em;">${type.total_suggestions} suggestions</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            statsContent.innerHTML = statsHtml;
        }
        
        // Auto-load history when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                loadDocumentHistory();
                updateHistoryStats();
            }, 1000);
        });

        // Deep Learning OCR Functions
        function displayDeepLearningResults(data) {
            // Show main extracted text
            extractedText.textContent = data.extracted_text || 'No text found in image.';
            
            // Show enhanced status with deep learning info
            const engineUsed = data.engine_used || 'Neural Network';
            const confidence = (data.confidence * 100).toFixed(1);
            const processingTime = data.processing_time ? ` (${data.processing_time.toFixed(2)}s)` : '';
            
            showStatus(`<i class="fas fa-brain"></i> Deep Learning OCR with ${engineUsed} completed! Confidence: ${confidence}%${processingTime}`, 'success');
            
            // Display deep learning specific information
            if (data.layout_analysis) {
                displayLayoutAnalysis(data.layout_analysis);
            }
            
            // Display text blocks information
            if (data.text_blocks && data.text_blocks.length > 0) {
                displayTextBlocksInfo(data.text_blocks);
            }
            
            // Show results section
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function displayLayoutAnalysis(layoutAnalysis) {
            let layoutDiv = document.getElementById('layoutAnalysis');
            if (!layoutDiv) {
                layoutDiv = document.createElement('div');
                layoutDiv.id = 'layoutAnalysis';
                layoutDiv.className = 'layout-analysis';
                layoutDiv.style.cssText = `
                    background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
                    border: 1px solid #28a745;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 20px 0;
                `;
                const resultsSection = document.getElementById('resultsSection');
                if (resultsSection) {
                    resultsSection.appendChild(layoutDiv);
                }
            }
            
            const structure = layoutAnalysis.structure || 'unknown';
            const regions = layoutAnalysis.regions || [];
            const confidence = layoutAnalysis.confidence_distribution || {};
            
            let html = `
                <h3 style="color: #28a745; margin-bottom: 15px;">
                    <i class="fas fa-sitemap"></i> Document Layout Analysis
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #d4edda;">
                        <div style="color: #28a745; font-size: 1.3em; font-weight: bold;">${structure.toUpperCase()}</div>
                        <div style="color: #6c757d; font-size: 0.9em;">Document Structure</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #d4edda;">
                        <div style="color: #28a745; font-size: 1.3em; font-weight: bold;">${regions.length}</div>
                        <div style="color: #6c757d; font-size: 0.9em;">Detected Regions</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #d4edda;">
                        <div style="color: #28a745; font-size: 1.3em; font-weight: bold;">${confidence.high_confidence_blocks || 0}</div>
                        <div style="color: #6c757d; font-size: 0.9em;">High Confidence Blocks</div>
                    </div>
                </div>
            `;
            
            if (regions.length > 0) {
                html += '<h4 style="color: #495057; margin-bottom: 10px;">Detected Regions:</h4>';
                regions.forEach((region, index) => {
                    const regionTypes = {
                        'header': { icon: 'fa-header', color: '#007bff' },
                        'body': { icon: 'fa-align-left', color: '#28a745' },
                        'footer': { icon: 'fa-align-center', color: '#6c757d' }
                    };
                    const typeInfo = regionTypes[region.type] || { icon: 'fa-square', color: '#17a2b8' };
                    
                    html += `
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                <i class="fas ${typeInfo.icon}" style="color: ${typeInfo.color}; margin-right: 8px;"></i>
                                <strong style="color: ${typeInfo.color};">${region.type.toUpperCase()}</strong>
                                <span style="background: #f8f9fa; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; margin-left: 10px;">
                                    ${region.blocks} blocks
                                </span>
                            </div>
                            <div style="color: #6c757d; font-size: 0.9em; max-height: 40px; overflow: hidden;">
                                ${region.text.substring(0, 100)}${region.text.length > 100 ? '...' : ''}
                            </div>
                        </div>
                    `;
                });
            }
            
            layoutDiv.innerHTML = html;
        }
        
        function displayTextBlocksInfo(textBlocks) {
            let blocksDiv = document.getElementById('textBlocksInfo');
            if (!blocksDiv) {
                blocksDiv = document.createElement('div');
                blocksDiv.id = 'textBlocksInfo';
                blocksDiv.className = 'text-blocks-info';
                blocksDiv.style.cssText = `
                    background: #f8f9fa;
                    border: 1px solid #dee2e6;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 20px 0;
                `;
                const resultsSection = document.getElementById('resultsSection');
                if (resultsSection) {
                    resultsSection.appendChild(blocksDiv);
                }
            }
            
            let html = `
                <h3 style="color: #495057; margin-bottom: 15px;">
                    <i class="fas fa-th-list"></i> Text Blocks Analysis (${textBlocks.length} blocks detected)
                </h3>
                <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            textBlocks.forEach((block, index) => {
                const confidence = (block.confidence * 100).toFixed(1);
                const confidenceClass = block.confidence > 0.8 ? '#28a745' : 
                                       block.confidence > 0.6 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div style="background: white; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-weight: bold; color: #495057;">Block ${index + 1}</span>
                            <span style="background: ${confidenceClass}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                ${confidence}%
                            </span>
                        </div>
                        <div style="color: #495057; font-family: monospace; font-size: 0.9em; background: #f8f9fa; padding: 8px; border-radius: 4px;">
                            ${block.text}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            blocksDiv.innerHTML = html;
        }
        
        function benchmarkOCREngines(file) {
            const formData = new FormData();
            formData.append('file', file);

            hideStatus();
            showProgress();
            updateProgress(20);
            showStatus('Uploading image for benchmarking...', 'info');

            fetch('/api/deep-learning-ocr/benchmark', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                updateProgress(60);
                showStatus('Benchmarking OCR engines...', 'info');
                return response.json();
            })
            .then(data => {
                updateProgress(100);
                hideProgress();
                
                if (data.success) {
                    showStatus(`OCR benchmark completed! Tested ${data.available_engines.length} engines`, 'success');
                    displayBenchmarkResults(data);
                } else {
                    showStatus(`<i class="fas fa-exclamation-triangle"></i> Benchmark failed: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                hideProgress();
                showStatus(`  Benchmark failed: ${error.message}`, 'error');
                console.error('Error:', error);
            });
        }
        
        function displayBenchmarkResults(data) {
            let benchmarkDiv = document.getElementById('benchmarkResults');
            if (!benchmarkDiv) {
                benchmarkDiv = document.createElement('div');
                benchmarkDiv.id = 'benchmarkResults';
                benchmarkDiv.className = 'benchmark-results';
                benchmarkDiv.style.cssText = `
                    background: linear-gradient(135deg, #fff3cd 0%, #f8d7da 100%);
                    border: 1px solid #ffc107;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 20px 0;
                `;
                resultsSection.appendChild(benchmarkDiv);
            }
            
            let html = `
                <h3 style="color: #856404; margin-bottom: 15px;">
                    <i class="fas fa-tachometer-alt"></i> OCR Engine Benchmark Results
                </h3>
            `;
            
            const results = data.benchmark_results;
            const comparison = results.comparison;
            
            // Display comparison summary if available
            if (comparison) {
                html += `
                    <div style="background: white; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="color: #856404; margin-bottom: 10px;">Performance Comparison</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                `;
                
                comparison.engines.forEach(engine => {
                    const confidence = comparison.confidences[engine] ? (comparison.confidences[engine] * 100).toFixed(1) : 'N/A';
                    const time = comparison.processing_times[engine] ? comparison.processing_times[engine].toFixed(2) : 'N/A';
                    const textLength = comparison.text_lengths[engine] || 0;
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: #495057;">${engine}</div>
                            <div style="font-size: 0.9em; color: #6c757d;">Confidence: ${confidence}%</div>
                            <div style="font-size: 0.9em; color: #6c757d;">Time: ${time}s</div>
                            <div style="font-size: 0.9em; color: #6c757d;">Length: ${textLength} chars</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                if (comparison.agreement_score !== undefined) {
                    const agreement = (comparison.agreement_score * 100).toFixed(1);
                    html += `<div style="margin-top: 10px; text-align: center; color: #856404;">
                        <strong>Text Agreement: ${agreement}%</strong>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // Display individual engine results
            Object.entries(results).forEach(([engineName, result]) => {
                if (engineName === 'comparison') return;
                
                if (result.error) {
                    html += `
                        <div style="background: white; border: 1px solid #dc3545; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #dc3545;">${engineName} - Error</h4>
                            <p style="color: #721c24; margin: 0;">${result.error}</p>
                        </div>
                    `;
                } else {
                    const confidence = (result.confidence * 100).toFixed(1);
                    const time = result.processing_time ? result.processing_time.toFixed(2) : 'N/A';
                    
                    html += `
                        <div style="background: white; border: 1px solid #28a745; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #28a745;">${engineName}</h4>
                            <div style="display: grid; grid-template-columns: auto auto; gap: 10px; margin-bottom: 10px; max-width: 400px;">
                                <span>Confidence:</span><span style="font-weight: bold;">${confidence}%</span>
                                <span>Processing Time:</span><span style="font-weight: bold;">${time}s</span>
                                <span>Text Length:</span><span style="font-weight: bold;">${result.text.length} chars</span>
                                <span>Text Blocks:</span><span style="font-weight: bold;">${result.text_blocks ? result.text_blocks.length : 0}</span>
                            </div>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 150px; overflow-y: auto; font-family: monospace; font-size: 0.9em;">
                                ${result.text.substring(0, 500)}${result.text.length > 500 ? '...' : ''}
                            </div>
                        </div>
                    `;
                }
            });
            
            benchmarkDiv.innerHTML = html;
            resultsSection.style.display = 'block';
            benchmarkDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function showOCRInfo() {
            fetch('/api/deep-learning-ocr/info')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayOCRInfo(data.info);
                    } else {
                        showStatus('Failed to load OCR information', 'error');
                    }
                })
                .catch(error => {
                    showStatus('Error loading OCR information', 'error');
                    console.error('OCR info error:', error);
                });
        }
        
        function displayOCRInfo(info) {
            const infoHtml = `
                <div id="ocrInfoModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;" onclick="closeOCRInfo()">
                    <div style="background: white; border-radius: 10px; max-width: 600px; max-height: 80vh; overflow-y: auto; padding: 0;" onclick="event.stopPropagation()">
                        <div style="background: #007bff; color: white; padding: 20px; border-radius: 10px 10px 0 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0;"><i class="fas fa-brain"></i> OCR Engine Information</h3>
                                <button onclick="closeOCRInfo()" style="background: none; border: none; color: white; font-size: 1.5em; cursor: pointer;">&times;</button>
                            </div>
                        </div>
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #495057; margin-bottom: 10px;">Available Engines</h4>
                                <div style="display: grid; gap: 10px;">
                                    ${info.available_engines.map(engine => `
                                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px;">
                                            <div style="font-weight: bold; color: #007bff;">${engine}</div>
                                            <div style="font-size: 0.9em; color: #6c757d;">
                                                ${engine === 'EasyOCR' ? 'Neural network OCR with multi-language support' : 
                                                  engine === 'PaddleOCR' ? 'Advanced deep learning OCR with layout analysis' : 
                                                  'Traditional tesseract OCR engine'}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #495057; margin-bottom: 10px;">Engine Status</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                    <div style="background: ${info.easyocr_available ? '#d4edda' : '#f8d7da'}; padding: 10px; border-radius: 6px; text-align: center;">
                                        <div style="color: ${info.easyocr_available ? '#155724' : '#721c24'}; font-weight: bold;">EasyOCR</div>
                                        <div style="color: ${info.easyocr_available ? '#155724' : '#721c24'}; font-size: 0.9em;">
                                            ${info.easyocr_available ? 'Available' : 'Not Available'}
                                        </div>
                                    </div>
                                    <div style="background: ${info.paddleocr_available ? '#d4edda' : '#f8d7da'}; padding: 10px; border-radius: 6px; text-align: center;">
                                        <div style="color: ${info.paddleocr_available ? '#155724' : '#721c24'}; font-weight: bold;">PaddleOCR</div>
                                        <div style="color: ${info.paddleocr_available ? '#155724' : '#721c24'}; font-size: 0.9em;">
                                            ${info.paddleocr_available ? 'Available' : 'Not Available'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="color: #495057; margin-bottom: 10px;">Default Configuration</h4>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 0.9em;">
                                    Confidence Threshold: ${info.default_config.confidence_threshold}<br>
                                    Languages: ${info.default_config.languages.join(', ')}<br>
                                    GPU Usage: ${info.default_config.use_gpu ? 'Enabled' : 'Disabled'}<br>
                                    Paragraph Mode: ${info.default_config.paragraph_mode ? 'Enabled' : 'Disabled'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', infoHtml);
        }
        
        function closeOCRInfo() {
            const modal = document.getElementById('ocrInfoModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateHistoryStats();
            updateFooterStats();
            initializeUploadUI();
        });
        
        // Enhanced Upload UI Functions
        function initializeUploadUI() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            
            // Enhanced drag and drop
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            
            // File input change
            fileInput.addEventListener('change', handleFileSelect);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropZone').classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropZone').classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropZone').classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileSelect({ target: { files: files } });
            }
        }
        
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                const file = files[0];
                validateAndProcessFile(file);
            }
        }
        
        function validateAndProcessFile(file) {
            // File size validation (10MB limit)
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showStatus('File too large. Maximum size is 10MB.', 'error');
                return;
            }
            
            // File type validation
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/bmp', 'image/tiff', 'image/webp', 'application/pdf'];
            if (!validTypes.includes(file.type)) {
                showStatus('Invalid file type. Please upload an image or PDF file.', 'error');
                return;
            }
            
            // Update UI and process file
            updateProgressUI(true);
            processFileWithProgress(file);
        }
        
        function updateProgressUI(show) {
            const progressSection = document.getElementById('progressSection');
            const resultsSection = document.getElementById('resultsSection');
            
            if (show) {
                progressSection.style.display = 'block';
                resultsSection.style.display = 'none';
                resetProgressSteps();
                updateProgress(0, 'Initializing...');
            } else {
                progressSection.style.display = 'none';
            }
        }
        
        function resetProgressSteps() {
            const steps = document.querySelectorAll('.step');
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });
        }
        
        function updateProgress(percentage, message) {
            const progressFill = document.getElementById('progressFill');
            const progressPercentage = document.getElementById('progressPercentage');
            
            progressFill.style.width = percentage + '%';
            progressPercentage.textContent = Math.round(percentage) + '%';
            
            // Update step indicators
            const steps = ['step-upload', 'step-preprocess', 'step-ocr', 'step-analyze', 'step-complete'];
            const currentStepIndex = Math.floor(percentage / 20);
            
            steps.forEach((stepId, index) => {
                const step = document.getElementById(stepId);
                if (index < currentStepIndex) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === currentStepIndex) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }
        
        function processFileWithProgress(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('ocrEngine', document.getElementById('ocrEngine').value);
            formData.append('language', document.getElementById('ocrLanguage')?.value || 'auto');
            formData.append('preprocessing', document.getElementById('preprocessing')?.value || 'auto');
            formData.append('enableClassification', document.getElementById('enableClassification')?.checked || true);
            formData.append('enableFieldSuggestion', document.getElementById('enableFieldSuggestion')?.checked || true);
            
            // Simulate progress updates
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                updateProgress(progress, 'Processing document...');
            }, 500);
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                clearInterval(progressInterval);
                updateProgress(100, 'Complete!');
                
                setTimeout(() => {
                    updateProgressUI(false);
                    if (data.success !== false) {
                        displayResults(data, file);
                    } else {
                        showStatus(`<i class="fas fa-exclamation-triangle"></i> Upload failed: ${data.error || 'Unknown error'}`, 'error');
                    }
                }, 1000);
            })
            .catch(error => {
                clearInterval(progressInterval);
                console.error('Error:', error);
                showStatus('Processing failed: ' + error.message, 'error');
                updateProgressUI(false);
            });
        }
        
        function displayResults(data, file = null) {
            const resultsSection = document.getElementById('resultsSection');
            const documentPreview = document.getElementById('documentPreview');
            const imageContainer = document.getElementById('imageContainer');
            const uploadedImage = document.getElementById('uploadedImage');
            
            // Show results section
            resultsSection.style.display = 'block';
            
            // Display image preview only if file is provided and is an image
            if (file && file.type && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage.src = e.target.result;
                    imageContainer.style.display = 'block';
                    updateImageInfo(file);
                };
                reader.readAsDataURL(file);
            }
            
            // Update text content
            const extractedText = document.getElementById('extractedText');
            extractedText.textContent = data.extracted_text || data.text || 'No text extracted';
            
            // Update statistics
            if (typeof updateTextStats === 'function') {
                updateTextStats(data);
            }
            
            // Handle other result data...
            if (data.document_classifications || data.classifications) {
                const classifications = data.document_classifications || data.classifications;
                if (typeof displayDocumentClassifications === 'function') {
                    displayDocumentClassifications(classifications);
                } else if (typeof displayClassifications === 'function') {
                    displayClassifications(classifications);
                }
            }
            
            if (data.rag_suggestions || data.suggestions) {
                const suggestions = data.rag_suggestions || data.suggestions;
                if (typeof displayRAGSuggestions === 'function') {
                    displayRAGSuggestions(suggestions);
                } else if (typeof displaySuggestions === 'function') {
                    displaySuggestions(suggestions);
                }
            }
            
            // Display structured data if available
            if (data.structured_data && Object.keys(data.structured_data).length > 0) {
                if (typeof displayUniversalStructuredData === 'function') {
                    displayUniversalStructuredData(data.document_type, data.structured_data);
                }
            }
            
            // Show success message
            const docType = data.document_type || 'document';
            const confidence = data.confidence ? ` (${(data.confidence * 100).toFixed(0)}% confidence)` : '';
            showStatus(`<i class="fas fa-check-circle"></i> ${docType.charAt(0).toUpperCase() + docType.slice(1)} processed successfully${confidence}`, 'success');
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function updateImageInfo(file) {
            const imageInfo = document.getElementById('imageInfo');
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            imageInfo.textContent = `${file.name} â€¢ ${fileSize} MB â€¢ ${file.type}`;
        }
        
        function updateTextStats(data) {
            const text = data.text || '';
            const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;
            const charCount = text.length;
            const confidence = Math.round((data.confidence || 0) * 100);
            const processingTime = (data.processing_time || 0).toFixed(2);
            
            document.getElementById('wordCount').textContent = wordCount;
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('ocrConfidence').textContent = confidence + '%';
            document.getElementById('processingTime').textContent = processingTime + 's';
        }
        
        // Image control functions
        let currentZoom = 1;
        
        function zoomIn() {
            currentZoom *= 1.2;
            applyZoom();
        }
        
        function zoomOut() {
            currentZoom /= 1.2;
            applyZoom();
        }
        
        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }
        
        function applyZoom() {
            const image = document.getElementById('uploadedImage');
            image.style.transform = `scale(${currentZoom})`;
        }
        
        function toggleFullscreen() {
            const imageContainer = document.getElementById('imageContainer');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                imageContainer.requestFullscreen();
            }
        }
        
        // Text formatting functions
        function formatText() {
            const textOutput = document.getElementById('extractedText');
            let text = textOutput.textContent;
            
            // Basic formatting: normalize whitespace, fix line breaks
            text = text.replace(/\s+/g, ' ').trim();
            text = text.replace(/\. /g, '.\\n');
            
            textOutput.textContent = text;
        }
        
        function downloadText() {
            const text = document.getElementById('extractedText').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'extracted_text.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Options functions
        function resetOptions() {
            document.getElementById('ocrEngine').value = 'auto';
            if (document.getElementById('ocrLanguage')) document.getElementById('ocrLanguage').value = 'auto';
            if (document.getElementById('preprocessing')) document.getElementById('preprocessing').value = 'auto';
            if (document.getElementById('enableClassification')) document.getElementById('enableClassification').checked = true;
            if (document.getElementById('enableFieldSuggestion')) document.getElementById('enableFieldSuggestion').checked = true;
            
            showStatus('Options reset to default values', 'info');
        }
        
        // Update footer statistics
        function updateFooterStats() {
            fetch('/api/document-history')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.records) {
                        const total = data.records.length;
                        const successCount = data.records.filter(record => 
                            record.confidence > 0.7
                        ).length;
                        
                        // Update footer stats
                        const totalProcessedEl = document.getElementById('totalProcessed');
                        const successfulDocsEl = document.getElementById('successfulDocs');
                        
                        if (totalProcessedEl) totalProcessedEl.textContent = total;
                        if (successfulDocsEl) successfulDocsEl.textContent = successCount;
                    }
                })
                .catch(error => console.error('Error updating footer stats:', error));
        }
    </script>
    </div>
    </div>
    
    <!-- App Footer -->
    <footer class="app-footer">
        <div class="footer-main">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About BlurD AI</h3>
                    <div class="footer-about">
                        <p>Advanced AI-powered document processing system that intelligently extracts text from various document types with high accuracy and confidence.</p>
                        <div class="footer-features">
                            <span class="feature-badge">AI Powered</span>
                            <span class="feature-badge">Secure</span>
                            <span class="feature-badge">Fast</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Features</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-brain"></i> Deep Learning OCR</a></li>
                        <li><a href="#"><i class="fas fa-file-alt"></i> Multi-Document Support</a></li>
                        <li><a href="#"><i class="fas fa-chart-bar"></i> Analytics Dashboard</a></li>
                        <li><a href="#"><i class="fas fa-history"></i> Processing History</a></li>
                        <li><a href="#"><i class="fas fa-download"></i> Data Export</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
                        <li><a href="#"><i class="fas fa-question-circle"></i> FAQ</a></li>
                        <li><a href="#"><i class="fas fa-envelope"></i> Contact Support</a></li>
                        <li><a href="#"><i class="fas fa-bug"></i> Report Issue</a></li>
                        <li><a href="#"><i class="fas fa-rocket"></i> API Access</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Live Statistics</h3>
                    <div class="footer-stats">
                        <div class="stat-grid">
                            <div class="stat-item-footer">
                                <span class="stat-number" id="totalProcessed">0</span>
                                <div class="stat-label">Documents Processed</div>
                            </div>
                            <div class="stat-item-footer">
                                <span class="stat-number" id="successfulDocs">0</span>
                                <div class="stat-label">Successful Extractions</div>
                            </div>
                            <div class="stat-item-footer">
                                <span class="stat-number">99.5%</span>
                                <div class="stat-label">Uptime</div>
                            </div>
                            <div class="stat-item-footer">
                                <span class="stat-number">12+</span>
                                <div class="stat-label">Document Types</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <div class="footer-copyright">
                    <p>&copy; 2025 BlurD AI. All rights reserved. | Powered by Advanced Neural Networks & Deep Learning</p>
                </div>
                <div class="footer-social">
                    <a href="#" class="social-link" title="GitHub"><i class="fab fa-github"></i></a>
                    <a href="#" class="social-link" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="#" class="social-link" title="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link" title="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>